{% load static %}
<!doctype html>

<html lang="es" data-layout="vertical" data-layout-width="fluid" data-sidebar="light" data-topbar="brand"
    data-preloader="disable" data-card-layout="border" data-bs-theme="light" data-topbar-image="pattern-2"
    data-sidebar-size="lg" data-layout-position="fixed">

<head>

    <meta charset="utf-8">
    <title>{% block title %} {% endblock title %} | Sistema</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="Minimal Admin & Dashboard Template" name="description">
    <meta content="Themesbrand" name="author">

    <!-- App favicon -->
    <link rel="shortcut icon" href="{% static 'images/imagenes_colegio/logoColegio.png' %}">
    <link rel="icon" href="{% static 'images/imagenes_colegio/logoColegio.png' %}">

    {% block css %}
    {% block extra_css %}
    {% endblock extra_css %}

    <!-- Layout config Js -->
    <script src="{% static 'js/layout.js' %}"></script>

    <!-- Bootstrap Css -->
    <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet" type="text/css">
    <!-- Icons Css -->
    <link href="{% static 'css/icons.min.css' %}" rel="stylesheet" type="text/css">
    <!-- App Css-->
    <link href="{% static 'css/app.min.css' %}" rel="stylesheet" type="text/css">
    <!-- custom Css-->
    <link href="{% static 'css/custom.css' %}" rel="stylesheet" type="text/css">
    <!-- Cards de Módulos -->
    <link href="{% static 'css/modulo-cards.css' %}" rel="stylesheet" type="text/css">
    <!-- Cards Institucionales -->
    <link href="{% static 'css/cards-institucionales.css' %}" rel="stylesheet" type="text/css">
    <!-- SweetAlert2 (para alertas de timeout) -->
    <link href="{% static 'libs/sweetalert2/sweetalert2.min.css' %}" rel="stylesheet" type="text/css">

    <!-- CSS: Corrección Definitiva V4 (Layout Ajustado) -->
    <style>
        /* =========================================
           ESTILOS GLOBALES - HEADER ANCHO COMPLETO
           ========================================= */
        #page-topbar {
            left: 0 !important;
            top: 0 !important;
            width: 100% !important;
            z-index: 2000 !important;
        }

        /* ESCRITORIO (>= 992px) */
        @media (min-width: 992px) {

            /* 1. SIDEBAR (MENÚ) - Ancho 180px */
            .app-menu.navbar-menu {
                width: 180px !important;
                /* Más estrecho para evitar huecos */
                position: fixed;
                left: 0;
                top: 70px !important;
                /* Debajo del header */
                bottom: 0;
                padding-top: 0 !important;
                z-index: 1000;
                border-right: 1px solid #e9ebec;
            }

            /* Logotipo oculto en sidebar (está en el header) */
            .navbar-brand-box {
                display: none !important;
            }

            /* Ajuste de items del menú */
            .app-menu .navbar-nav {
                margin-top: 0 !important;
                padding-top: 10px !important;
            }

            .navbar-nav .nav-link {
                padding: 10px 15px !important;
                white-space: nowrap;
                /* Evitar que el texto salte */
            }

            .navbar-nav .nav-link i {
                margin-right: 8px;
                font-size: 18px;
                width: 20px;
                text-align: center;
            }

            /* 2. CONTENIDO PRINCIPAL - ALINEACIÓN MATEMÁTICA EXACTA */
            html body .main-content {
                margin-left: 240px !important;
                /* 240px EXACTOS */
                margin-top: 70px !important;
                width: calc(100% - 240px) !important;
                min-height: calc(100vh - 70px);
                padding: 0 !important;
                overflow-x: hidden !important;
            }

            .footer {
                left: 240px !important;
                width: calc(100% - 240px) !important;
            }

            /* 3. CERO GAP - PEGADO AL MENU */
            html body .page-content {
                /* Arriba | Derecha | Abajo | Izquierda */
                padding: 1.5rem 1.5rem 1.5rem 0px !important;
                /* Izquierda 0px: ELIMINA CUALQUIER HUECO VISUAL */
                width: 100% !important;
                overflow-x: hidden !important;
            }

            /* Contenedor fluido sin padding extra */
            html body .container-fluid {
                padding-left: 10px !important;
                /* Pequeño respiro de 10px para que no toque la línea */
                padding-right: 0 !important;
                margin: 0 !important;
                max-width: none !important;
                width: 100% !important;
            }

            /* Ocultar móvil/colapso */
            .topnav-hamburger,
            .logo-sm {
                display: none !important;
            }

            /* Visibilidad forzada */
            .menu-title,
            .nav-link span,
            .logo-lg {
                display: block !important;
                opacity: 1 !important;
                visibility: visible !important;
            }
        }

        /* MÓVIL (< 992px) */
        @media (max-width: 991.98px) {
            #page-topbar {
                left: 0 !important;
                width: 100% !important;
            }

            .main-content {
                margin-left: 0 !important;
                width: 100% !important;
                margin-top: 70px !important;
            }

            .footer {
                left: 0 !important;
                width: 100% !important;
            }

            .topnav-hamburger {
                display: block !important;
            }

            .navbar-brand-box {
                display: block !important;
            }

            /* Mostrar logo en movil si es necesario */
        }
    </style>
    }
    }

    /* MÓVIL / TABLET (< 992px): Overlay Clásico */ @media (max-width: 991.98px) { #page-topbar { left: 0 !important;
        width: 100% !important; } .main-content { margin-left: 0 !important; width: 100% !important; } .footer { left: 0
        !important; width: 100% !important; } .topnav-hamburger { display: block !important; } /* El menú flota sobre el
        contenido */ .navbar-menu { z-index: 9999 !important; } } </style>
        {% endblock css %}

</head>

{% block body %}

<body>
    {% endblock body %}


    <!-- Begin page -->
    <div id="layout-wrapper">

        {% include "partials/sidebar.html" %}

        {% block topbar %}
        {% include "partials/topbar.html" %}
        {% endblock topbar %}

        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">

                    {% block main_title %}

                    {% endblock main_title %}


                    {% block content %}

                    {% endblock content %}

                </div>
                <!-- container-fluid -->
            </div>
            <!-- End Page-content -->

            {% block footer %}
            {% include "partials/footer.html" %}
            {% endblock footer %}

        </div>
        <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->

    <!-- Modal para Mensajes de Django -->
    {% if messages %}
    <div class="modal fade" id="mensajesModal" tabindex="-1" aria-labelledby="mensajesModalLabel" aria-hidden="true"
        data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div
                    class="modal-header {% for message in messages %}{% if message.tags == 'success' %}bg-success{% elif message.tags == 'error' or message.tags == 'danger' %}bg-danger{% elif message.tags == 'warning' %}bg-warning{% elif message.tags == 'info' %}bg-info{% else %}bg-primary{% endif %}{% endfor %} text-white">
                    <h5 class="modal-title" id="mensajesModalLabel">
                        {% for message in messages %}
                        {% if message.tags == 'success' %}
                        <i class="ri-checkbox-circle-line me-2"></i>Éxito
                        {% elif message.tags == 'error' or message.tags == 'danger' %}
                        <i class="ri-error-warning-line me-2"></i>Error
                        {% elif message.tags == 'warning' %}
                        <i class="ri-alert-line me-2"></i>Advertencia
                        {% elif message.tags == 'info' %}
                        <i class="ri-information-line me-2"></i>Información
                        {% else %}
                        <i class="ri-notification-line me-2"></i>Mensaje
                        {% endif %}
                        {% endfor %}
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                        aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    {% for message in messages %}
                    <div class="mb-2 {% if not forloop.last %}border-bottom pb-2{% endif %}">
                        <p class="mb-0">{{ message }}</p>
                    </div>
                    {% endfor %}
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    {% block extra_content %}
    {% endblock extra_content %}

    {% block javascript %}

    <!-- JAVASCRIPT -->
    <script src="{% static 'libs/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
    <script src="{% static 'libs/simplebar/simplebar.min.js' %}"></script>
    <script src="{% static 'js/plugins.js' %}"></script>

    {% block extra_js %}
    {% endblock extra_js %}

    <!-- Filtrado dinámico de modelos por marca -->
    <script src="{% static 'js/filtrar-modelos.js' %}"></script>

    <!-- App js -->
    <script src="{% static 'js/app.js' %}"></script>
    <!-- SweetAlert2 (para alertas de timeout) -->
    <script src="{% static 'libs/sweetalert2/sweetalert2.min.js' %}"></script>
    <!-- Session Timeout js -->
    <script src="{% static 'js/session-timeout.js' %}"></script>

    {% endblock javascript %}


    <script>
        // Forzar recalculo de layout al cargar
        window.dispatchEvent(new Event('resize'));

        // Mostrar modal de mensajes automáticamente si existen mensajes
        // EXCEPTO mensajes de login/logout
        {% if messages %}
        document.addEventListener('DOMContentLoaded', function () {
            var modalElement = document.getElementById('mensajesModal');
            if (!modalElement) return;

            // Obtener todos los mensajes del modal
            var mensajes = modalElement.querySelectorAll('.modal-body p');
            var tieneMensajesValidos = false;

            // Textos a filtrar (mensajes de login/logout)
            var textosFiltrados = [
                'inició sesión',
                'cerró sesión',
                'Ha iniciado sesión',
                'Ha cerrado sesión',
                'inicio sesion',
                'cerro sesion'
            ];

            // Verificar si hay mensajes que NO sean de login/logout
            mensajes.forEach(function (mensaje) {
                var textoMensaje = mensaje.textContent.toLowerCase();
                var esMensajeLoginLogout = textosFiltrados.some(function (texto) {
                    return textoMensaje.includes(texto.toLowerCase());
                });

                if (!esMensajeLoginLogout) {
                    tieneMensajesValidos = true;
                } else {
                    // Ocultar el mensaje de login/logout del modal
                    mensaje.closest('.mb-2').style.display = 'none';
                }
            });

            // Solo mostrar el modal si hay mensajes válidos
            if (tieneMensajesValidos) {
                var mensajesModal = new bootstrap.Modal(modalElement);
                mensajesModal.show();
            } else {
                // Si solo hay mensajes de login/logout, ocultar todo el modal
                modalElement.style.display = 'none';
            }
        });
        {% endif %}
    </script>
</body>

</html>