{% load static %}
<!doctype html>

<html lang="es" data-layout="vertical" data-layout-width="fluid" data-sidebar="light" data-topbar="brand"
    data-preloader="disable" data-card-layout="border" data-bs-theme="light" data-topbar-image="pattern-2"
    data-sidebar-size="lg" data-layout-position="fixed">

<head>

    <meta charset="utf-8">
    <title>{% block title %} {% endblock title %} | Sistema</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="Minimal Admin & Dashboard Template" name="description">
    <meta content="Themesbrand" name="author">

    <!-- App favicon -->
    <link rel="shortcut icon" href="{% static 'images/imagenes_colegio/logoColegio.png' %}">
    <link rel="icon" href="{% static 'images/imagenes_colegio/logoColegio.png' %}">

    {% block css %}
    {% block extra_css %}
    {% endblock extra_css %}

    <!-- Layout config Js -->
    <script src="{% static 'js/layout.js' %}"></script>

    <!-- Bootstrap Css -->
    <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet" type="text/css">
    <!-- Icons Css -->
    <link href="{% static 'css/icons.min.css' %}" rel="stylesheet" type="text/css">
    <!-- App Css-->
    <link href="{% static 'css/app.min.css' %}" rel="stylesheet" type="text/css">
    <!-- custom Css-->
    <link href="{% static 'css/custom.css' %}" rel="stylesheet" type="text/css">
    <!-- Cards de Módulos -->
    <link href="{% static 'css/modulo-cards.css' %}" rel="stylesheet" type="text/css">
    <!-- Cards Institucionales -->
    <link href="{% static 'css/cards-institucionales.css' %}" rel="stylesheet" type="text/css">
    <!-- SweetAlert2 (para alertas de timeout) -->
    <link href="{% static 'libs/sweetalert2/sweetalert2.min.css' %}" rel="stylesheet" type="text/css">

    <!-- CSS: Corrección Definitiva V3 (Logo centrado y Sin Hover) -->
    <style>
        /* =========================================
           1. HOVER KILLER (Muerte al Hover)
           ========================================= */
        /* Forzar que el modo 'sm-hover' se comporte EXACTAMENTE como 'sm' (fijo pequeño) */
        html[data-sidebar-size="sm-hover"] .navbar-menu:hover,
        html[data-sidebar-size="sm-hover"] .navbar-menu {
            width: var(--vz-vertical-menu-width-sm) !important;
        }

        /* Ocultar textos en modo sm-hover incluso al pasar el mouse */
        html[data-sidebar-size="sm-hover"] .navbar-menu:hover .nav-link span,
        html[data-sidebar-size="sm-hover"] .navbar-menu:hover .menu-title,
        html[data-sidebar-size="sm-hover"] .navbar-menu:hover .badge {
            display: none !important;
        }

        /* =========================================
           2. LOGO CORRECTION (Todo centrado)
           ========================================= */
        /* Asegurar que el contenedor del logo tenga el ancho correcto y esté centrado */
        html[data-sidebar-size="sm-hover"] .navbar-brand-box {
            width: var(--vz-vertical-menu-width-sm) !important;
            padding: 0 !important;
            display: flex;
            justify-content: center;
            align-items: center;
            background: transparent;
        }

        /* Ocultar logo grande en modo pequeño */
        html[data-sidebar-size="sm-hover"] .navbar-brand-box .logo-lg {
            display: none !important;
        }

        /* Mostrar logo pequeño y centrarlo */
        html[data-sidebar-size="sm-hover"] .navbar-brand-box .logo-sm {
            display: block !important;
            margin: 0 auto;
        }

        /* =========================================
           3. ICONOS (Alineación perfecta y Estilo)
           ========================================= */
        /* Centrar los iconos en la barra pequeña */
        html[data-sidebar-size="sm"] .navbar-nav .nav-link i,
        html[data-sidebar-size="sm-hover"] .navbar-nav .nav-link i {
            margin-right: 0 !important;
            text-align: center;
            font-size: 22px;
            /* Tamaño ajustado y limpio */
            width: 100%;
            display: block;
        }

        /* Ajuste fino del contenedor del link en colapsado */
        html[data-sidebar-size="sm"] .navbar-nav .nav-link,
        html[data-sidebar-size="sm-hover"] .navbar-nav .nav-link {
            padding: 10px 0 !important;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* =========================================
           4. LAYOUT FIX (Barra Azul vs Menu Blanco & Colapso)
           ========================================= */

        /* ESTADO EXPANDIDO (Default) */
        @media (min-width: 992px) {

            /* Sidebar Normal */
            .app-menu.navbar-menu {
                width: 250px !important;
                z-index: 1004;
                transition: none !important;
                /* Evitar animaciones raras */
            }

            /* Contenido Normal */
            #page-topbar,
            .footer {
                left: 250px !important;
                width: calc(100% - 250px) !important;
                transition: none !important;
                z-index: 1005;
            }

            .main-content {
                margin-left: 250px !important;
                transition: none !important;
            }

            /* Navbar brand box width correction */
            .navbar-brand-box {
                width: 250px !important;
            }

            /* --- ESTADO COLAPSADO (Clase que agrega el JS al body) --- */
            /* IMPORTANTE: Tratamos 'sm' y 'sm-hover' IGUAL para evitar expansión al pasar el mouse */
            html[data-sidebar-size="sm"] .app-menu.navbar-menu,
            html[data-sidebar-size="sm-hover"] .app-menu.navbar-menu {
                width: 70px !important;
                /* Solo iconos */
                position: fixed;
            }

            html[data-sidebar-size="sm"] .navbar-brand-box,
            html[data-sidebar-size="sm-hover"] .navbar-brand-box {
                width: 70px !important;
                padding: 0 !important;
                justify-content: center !important;
            }

            /* Ocultar textos en colapsado */
            html[data-sidebar-size="sm"] .menu-title,
            html[data-sidebar-size="sm"] .nav-link span,
            html[data-sidebar-size="sm"] .logo-lg,
            html[data-sidebar-size="sm-hover"] .logo-lg {
                display: none !important;
            }

            /* Ocultar flechas de dropdown en colapsado */
            html[data-sidebar-size="sm"] .menu-dropdown .dropdown-icon,
            html[data-sidebar-size="sm-hover"] .menu-dropdown .dropdown-icon {
                display: none !important;
            }

            /* Mostrar logo pequeño en colapsado */
            html[data-sidebar-size="sm"] .logo-sm,
            html[data-sidebar-size="sm-hover"] .logo-sm {
                display: block !important;
            }

            /* Contenido Ajustado al Colapso (AQUÍ ESTÁ LA MAGIA) */
            html[data-sidebar-size="sm"] #page-topbar,
            html[data-sidebar-size="sm"] .footer,
            html[data-sidebar-size="sm-hover"] #page-topbar,
            html[data-sidebar-size="sm-hover"] .footer {
                left: 70px !important;
                width: calc(100% - 70px) !important;
            }

            html[data-sidebar-size="sm"] .main-content,
            html[data-sidebar-size="sm-hover"] .main-content {
                margin-left: 70px !important;
            }
        }

        /* MÓVIL / TABLET */
        @media (max-width: 991.98px) {
            #page-topbar {
                left: 0 !important;
                width: 100% !important;
            }

            .main-content {
                margin-left: 0 !important;
            }

            .footer {
                left: 0 !important;
                width: 100% !important;
            }

            /*.navbar-menu { z-index: 1006 !important; }*/
        }


        /* El menú se comporta como overlay */
        .navbar-menu {
            z-index: 1006 !important;
            /* Por encima del topbar en móvil */
        }
        }
    </style>
    {% endblock css %}

</head>

{% block body %}

<body>
    {% endblock body %}


    <!-- Begin page -->
    <div id="layout-wrapper">

        {% include "partials/sidebar.html" %}

        {% block topbar %}
        {% include "partials/topbar.html" %}
        {% endblock topbar %}

        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">

                    {% block main_title %}

                    {% endblock main_title %}


                    {% block content %}

                    {% endblock content %}

                </div>
                <!-- container-fluid -->
            </div>
            <!-- End Page-content -->

            {% block footer %}
            {% include "partials/footer.html" %}
            {% endblock footer %}

        </div>
        <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->

    <!-- Modal para Mensajes de Django -->
    {% if messages %}
    <div class="modal fade" id="mensajesModal" tabindex="-1" aria-labelledby="mensajesModalLabel" aria-hidden="true"
        data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div
                    class="modal-header {% for message in messages %}{% if message.tags == 'success' %}bg-success{% elif message.tags == 'error' or message.tags == 'danger' %}bg-danger{% elif message.tags == 'warning' %}bg-warning{% elif message.tags == 'info' %}bg-info{% else %}bg-primary{% endif %}{% endfor %} text-white">
                    <h5 class="modal-title" id="mensajesModalLabel">
                        {% for message in messages %}
                        {% if message.tags == 'success' %}
                        <i class="ri-checkbox-circle-line me-2"></i>Éxito
                        {% elif message.tags == 'error' or message.tags == 'danger' %}
                        <i class="ri-error-warning-line me-2"></i>Error
                        {% elif message.tags == 'warning' %}
                        <i class="ri-alert-line me-2"></i>Advertencia
                        {% elif message.tags == 'info' %}
                        <i class="ri-information-line me-2"></i>Información
                        {% else %}
                        <i class="ri-notification-line me-2"></i>Mensaje
                        {% endif %}
                        {% endfor %}
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                        aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    {% for message in messages %}
                    <div class="mb-2 {% if not forloop.last %}border-bottom pb-2{% endif %}">
                        <p class="mb-0">{{ message }}</p>
                    </div>
                    {% endfor %}
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    {% block extra_content %}
    {% endblock extra_content %}

    {% block javascript %}

    <!-- JAVASCRIPT -->
    <script src="{% static 'libs/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
    <script src="{% static 'libs/simplebar/simplebar.min.js' %}"></script>
    <script src="{% static 'js/plugins.js' %}"></script>

    {% block extra_js %}
    {% endblock extra_js %}

    <!-- Filtrado dinámico de modelos por marca -->
    <script src="{% static 'js/filtrar-modelos.js' %}"></script>

    <!-- App js -->
    <script src="{% static 'js/app.js' %}"></script>
    <!-- SweetAlert2 (para alertas de timeout) -->
    <script src="{% static 'libs/sweetalert2/sweetalert2.min.js' %}"></script>
    <!-- Session Timeout js -->
    <script src="{% static 'js/session-timeout.js' %}"></script>

    {% endblock javascript %}


    <script>
        // Forzar recalculo de layout al cargar
        window.dispatchEvent(new Event('resize'));

        // Mostrar modal de mensajes automáticamente si existen mensajes
        // EXCEPTO mensajes de login/logout
        {% if messages %}
        document.addEventListener('DOMContentLoaded', function () {
            var modalElement = document.getElementById('mensajesModal');
            if (!modalElement) return;

            // Obtener todos los mensajes del modal
            var mensajes = modalElement.querySelectorAll('.modal-body p');
            var tieneMensajesValidos = false;

            // Textos a filtrar (mensajes de login/logout)
            var textosFiltrados = [
                'inició sesión',
                'cerró sesión',
                'Ha iniciado sesión',
                'Ha cerrado sesión',
                'inicio sesion',
                'cerro sesion'
            ];

            // Verificar si hay mensajes que NO sean de login/logout
            mensajes.forEach(function (mensaje) {
                var textoMensaje = mensaje.textContent.toLowerCase();
                var esMensajeLoginLogout = textosFiltrados.some(function (texto) {
                    return textoMensaje.includes(texto.toLowerCase());
                });

                if (!esMensajeLoginLogout) {
                    tieneMensajesValidos = true;
                } else {
                    // Ocultar el mensaje de login/logout del modal
                    mensaje.closest('.mb-2').style.display = 'none';
                }
            });

            // Solo mostrar el modal si hay mensajes válidos
            if (tieneMensajesValidos) {
                var mensajesModal = new bootstrap.Modal(modalElement);
                mensajesModal.show();
            } else {
                // Si solo hay mensajes de login/logout, ocultar todo el modal
                modalElement.style.display = 'none';
            }
        });
        {% endif %}
    </script>
</body>

</html>